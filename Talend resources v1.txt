{

"AWSTemplateFormatVersion": "2010-09-09",

"Parameters" : {
  "appinstanceparameter" : {
    "Type" : "String",
    "Default" : "r5.2xlarge"},
	
  "keypairparameter" : {
    "Type" : "String",
    "Default" : "harshalkeypair2"} 
  },

"Resources": {

   "TalendDemoVPC": {

            "Type": "AWS::EC2::VPC",

            "Properties": {

			 "CidrBlock": "10.0.0.0/16",

			 "Tags" : [{"Key": "Category", "Value":"Talend Demo"}]

				}

            },

			

	"AppSubnet": {

			"Type" : "AWS::EC2::Subnet",

			"Properties" : {

				"VpcId" : { "Ref" : "TalendDemoVPC" },

				"CidrBlock" : "10.0.0.0/24",

				"Tags" : [ { "Key" : "Category", "Value": "Talend Demo"} ]

				}

			},

 

	"DBSubnet": {

			"Type" : "AWS::EC2::Subnet",

			"Properties" : {

				"VpcId" : { "Ref" : "TalendDemoVPC" },

				"CidrBlock" : "10.0.1.0/24",

				"Tags" : [ { "Key" : "Category", "Value": "Talend Demo"} ]

				}

			}, 

			

	"AppSecGrp" : {

			"Type" : "AWS::EC2::SecurityGroup",

			"Properties" : {

				"GroupDescription" : "Allow http, https, rdp, postgresql and ssh to hosts",

				"VpcId" : {"Ref" : "TalendDemoVPC"},

				"SecurityGroupIngress" : [

						{

						"IpProtocol" : "tcp",

						"FromPort" : 22,

						"ToPort" : 22,

						"CidrIp" : "0.0.0.0/0"},

						{

						"IpProtocol" : "tcp",

						"FromPort" : 80,

						"ToPort" : 80,

						"CidrIp" : "0.0.0.0/0"},

						{

						"IpProtocol" : "tcp",

						"FromPort" : 443,

						"ToPort" : 443,

						"CidrIp" : "0.0.0.0/0"},

						{

						"IpProtocol" : "tcp",

						"FromPort" : 3389,

						"ToPort" : 3389,

						"CidrIp" : "0.0.0.0/0"},

						{

						"IpProtocol" : "tcp",

						"FromPort" : 5432,

						"ToPort" : 5432,

						"CidrIp" : "0.0.0.0/0"}

						]

						}},
						

	"TalendDemoIG" : {

				"Type" : "AWS::EC2::InternetGateway",

				"Properties" : {

				"Tags" : [ { "Key" : "Category", "Value": "Talend Demo"} ]

								}

					},



	"TalendVPCIG" : {

				"Type" : "AWS::EC2::VPCGatewayAttachment",

				"Properties" : {

					"InternetGatewayId" : {"Ref" : "TalendDemoIG"},

					"VpcId" : {"Ref" : "TalendDemoVPC"}

								}

					},

	"PubRouteTable" : {
					"Type" : "AWS::EC2::RouteTable",
					"Properties" : {
					"VpcId" : {"Ref" : "TalendDemoVPC"},
					"Tags" : [ { "Key" : "Category", "Value": "Talend Demo"} ]
									}
							},
							
	
	"IGRoute" : {
					"Type" : "AWS::EC2::Route",
					"DependsOn" : "TalendVPCIG",
					"Properties" : {
					"RouteTableId" : { "Ref" : "PubRouteTable" },
					"DestinationCidrBlock" : "0.0.0.0/0",
					"GatewayId" : { "Ref" : "TalendDemoIG" }
									}
				},		

	"AppSubnetRoute" : {
					"Type" : "AWS::EC2::SubnetRouteTableAssociation",
					"Properties" : {
					"RouteTableId" : { "Ref" : "PubRouteTable" },
					"SubnetId" : { "Ref" : "AppSubnet" }
									}
					},				

   "TalendLinux": {

			"Type" : "AWS::EC2::Instance",

			"Properties" : {

			"InstanceType" : { "Ref" : "appinstanceparameter" },

			"ImageId" : "ami-0f511ead81ccde020",

			"Tags" : [ { "Key" : "Category", "Value": "Talend Demo"} ],

			"NetworkInterfaces": [ {

					"AssociatePublicIpAddress": "true",

					"DeviceIndex": "0",

					"GroupSet": [{ "Ref" : "AppSecGrp" }],

					"SubnetId": { "Ref" : "AppSubnet" }

								} ],

			"KeyName" : { "Ref" : "keypairparameter" },

			"BlockDeviceMappings" : [

									{

										"DeviceName" : "/dev/xvda",

										"Ebs" : { "VolumeSize" : "100" }

									},

									{

										"DeviceName" : "/dev/sdb",

										"Ebs" : { "VolumeSize" : "300" }

									}

									]

			}

			},

			

   "TalendWindows": {

			"Type" : "AWS::EC2::Instance",

			"Properties" : {

			"InstanceType" : { "Ref" : "appinstanceparameter" },

			"ImageId" : "ami-0a2232786115639d7",

			"Tags" : [ { "Key" : "Category", "Value": "Talend Demo"} ],

			"NetworkInterfaces": [ {

					"AssociatePublicIpAddress": "true",

					"DeviceIndex": "0",

					"GroupSet": [{ "Ref" : "AppSecGrp" }],

					"SubnetId": { "Ref" : "AppSubnet" }

								} ],

			"KeyName" : { "Ref" : "keypairparameter" },

			"BlockDeviceMappings" : [

									{

										"DeviceName" : "/dev/sda1",

										"Ebs" : { "VolumeSize" : "100" }

									},

									{

										"DeviceName" : "xvdc",

										"Ebs" : { "VolumeSize" : "300" }

									}

									]

			}

			}			

			

			

			

   

   

   }

}
